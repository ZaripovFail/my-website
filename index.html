<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–∏–Ω–∏–º–∞–ª –î–∞—à–±–æ—Ä–¥</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <style>
    :root {
      --bg-light: #f4f4f4;
      --bg-dark: #1e1e1e;
      --text-light: #222;
      --text-dark: #f0f0f0;
      --accent: #007aff;
      --card: white;
      --radius: 14px;
    }
    body {
      font-family: "Inter", sans-serif;
      margin: 0;
      background: var(--bg-light);
      color: var(--text-light);
      transition: 0.3s;
    }
    body.dark {
      background: var(--bg-dark);
      color: var(--text-dark);
    }
    header {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1.5rem 2rem;
      background: var(--card);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      font-weight: 700;
      font-size: 1.8rem;
      color: var(--accent);
      letter-spacing: 2px;
      user-select: none;
    }
    .lang-switcher {
      display: none; /* —É–±–∏—Ä–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ */
    }
    .container {
      max-width: 1000px;
      margin: 2rem auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      padding: 0 1rem;
    }
    .card {
      background: var(--card);
      padding: 1.5rem 1.8rem;
      border-radius: var(--radius);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      user-select: none;
    }
    .card h2 {
      margin-top: 0;
      font-size: 1.3rem;
      margin-bottom: 1rem;
      color: var(--accent);
    }
    .dark .card {
      background: #2a2a2a;
    }
    .dark header {
      background: #2a2a2a;
    }
    .dark select,
    .dark input,
    .dark textarea {
      background: #333;
      color: #f0f0f0;
    }
    footer {
      text-align: center;
      padding: 2rem;
      color: #888;
      user-select: none;
    }
    /* –ó–∞–º–µ—Ç–∫–∏ */
    #notesList {
      width: 100%;
      max-height: 250px;
      overflow-y: auto;
      margin-top: 0.5rem;
      text-align: left;
    }
    .note-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    .note-item label {
      flex-grow: 1;
      margin-left: 8px;
      cursor: pointer;
      user-select: text;
    }
    .completed {
      text-decoration: line-through;
      opacity: 0.6;
    }
    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal.show {
      display: flex;
    }
    .modal-content {
      background: var(--card);
      padding: 1.5rem 2rem;
      border-radius: 10px;
      width: 90%;
      max-width: 450px;
      box-sizing: border-box;
    }
    .modal-content.dark {
      background: #2a2a2a;
    }
    .modal input, .modal select {
      width: 100%;
      padding: 0.6rem;
      margin-top: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-size: 1rem;
    }
    .modal button {
      margin-top: 15px;
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: var(--accent);
      color: white;
      transition: background 0.2s;
    }
    .modal button:hover {
      background: #005bb5;
    }
    .modal button.close-btn {
      background: #ccc;
      color: #333;
      margin-left: 10px;
    }
    .modal button.close-btn:hover {
      background: #aaa;
    }
    /* –ü–æ–≥–æ–¥–∞ –∏ –∏–∫–æ–Ω–∫–∞ */
    #weather {
      display: flex;
      align-items: center;
      font-size: 1.3rem;
      gap: 10px;
    }
    #weather img {
      width: 48px;
      height: 48px;
    }
    /* –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∑–∞–º–µ—Ç–æ–∫ */
    #openNotesBtn {
      margin-top: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      background: var(--accent);
      color: white;
      cursor: pointer;
      transition: background 0.2s;
    }
    #openNotesBtn:hover {
      background: #005bb5;
    }
    /* –°–µ–ª–µ–∫—Ç–æ—Ä —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤ */
    #timezone {
      margin-bottom: 1rem;
      padding: 0.5rem 0.7rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
      cursor: pointer;
      user-select: none;
    }
  </style>
</head>
<body>
  <header>–ú–∏–Ω–∏–º–∞–ª –î–∞—à–±–æ—Ä–¥</header>

  <main class="container">
    <section class="card">
      <h2>–ü–æ–≥–æ–¥–∞</h2>
      <div id="weather">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </section>
    <section class="card">
      <h2>–í—Ä–µ–º—è</h2>
      <select id="timezone" aria-label="–í—ã–±–æ—Ä —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞">
        <option value="Europe/Moscow" selected>–ú–æ—Å–∫–≤–∞</option>
        <option value="America/New_York">–ù—å—é-–ô–æ—Ä–∫</option>
      </select>
      <div id="time" style="font-size: 2rem; font-weight: 600; user-select:none;">--:--</div>
    </section>
    <section class="card">
      <h2>–ö—É—Ä—Å –≤–∞–ª—é—Ç</h2>
      <div id="currency">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </section>
    <section class="card">
      <h2>–ó–∞–º–µ—Ç–∫–∏</h2>
      <button id="openNotesBtn">–û—Ç–∫—Ä—ã—Ç—å –∑–∞–º–µ—Ç–∫–∏</button>
      <div id="notesList"></div>
    </section>
  </main>

  <div class="modal" id="notesModal" role="dialog" aria-modal="true" aria-labelledby="notesTitle">
    <div class="modal-content" id="modalContent">
      <h3 id="notesTitle">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</h3>
      <input type="text" id="noteText" placeholder="–¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏" aria-label="–¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏" />
      <select id="notePriority" aria-label="–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–º–µ—Ç–∫–∏">
        <option value="low">–ù–∏–∑–∫–∏–π</option>
        <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
        <option value="high">–í—ã—Å–æ–∫–∏–π</option>
      </select>
      <div style="margin-top: 1rem;">
        <button id="addNoteBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
        <button id="closeNotesBtn" class="close-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <footer>&copy; 2025 –ú–∏–Ω–∏–º–∞–ª –î–∞—à–±–æ—Ä–¥</footer>

  <script>
    (() => {
      // –¢–µ–º–∞ –∏–∑ localStorage
      const themeBtn = document.createElement("button");
      themeBtn.id = "themeToggleBtn";
      themeBtn.style.position = "fixed";
      themeBtn.style.top = "10px";
      themeBtn.style.right = "10px";
      themeBtn.style.fontSize = "1.5rem";
      themeBtn.style.background = "none";
      themeBtn.style.border = "none";
      themeBtn.style.cursor = "pointer";
      themeBtn.style.userSelect = "none";
      themeBtn.title = "–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É";
      document.body.appendChild(themeBtn);

      function updateThemeButton() {
        themeBtn.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";
      }

      themeBtn.onclick = () => {
        document.body.classList.toggle("dark");
        modalContent.classList.toggle("dark");
        updateThemeButton();
        localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
      };

      if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark");
        document.getElementById("modalContent").classList.add("dark");
      }
      updateThemeButton();

      // --- –í—Ä–µ–º—è ---
      const timezoneSelect = document.getElementById("timezone");
      const timeDiv = document.getElementById("time");

      function updateTime() {
        const tz = timezoneSelect.value;
        const now = new Date();
        const options = {
          hour: "2-digit",
          minute: "2-digit",
          hour12: false,
          timeZone: tz,
        };
        const timeString = now.toLocaleTimeString("ru-RU", options).slice(0, 5); // –±–µ–∑ —Å–µ–∫—É–Ω–¥
        timeDiv.textContent = timeString;
      }
      timezoneSelect.addEventListener("change", updateTime);
      setInterval(updateTime, 1000);
      updateTime();

      // --- –ü–æ–≥–æ–¥–∞ —Å –∏–∫–æ–Ω–∫–æ–π ---
      const weatherDiv = document.getElementById("weather");
      const apiKey = "87bed00ad1d3b7c292017260b3f9f09e";
      const city = "Kazan";

      function loadWeather() {
        fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=ru`)
          .then((r) => r.json())
          .then((data) => {
            if (data && data.weather && data.main) {
              const iconCode = data.weather[0].icon;
              const iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
              const temp = Math.round(data.main.temp);
              const desc = data.weather[0].description;

              weatherDiv.innerHTML = `
                <img src="${iconUrl}" alt="${desc}" />
                <div>${city}: ${temp}¬∞C, ${desc}</div>
              `;
            } else {
              weatherDiv.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–≥–æ–¥—É.";
            }
          })
          .catch(() => {
            weatherDiv.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–≥–æ–¥—É.";
          });
      }
      loadWeather();

      // --- –ö—É—Ä—Å –≤–∞–ª—é—Ç ---
      const currencyDiv = document.getElementById("currency");
      function loadCurrency() {
        fetch("https://api.exchangerate.host/latest?base=RUB&symbols=USD,EUR,CNY")
          .then((r) => r.json())
          .then((data) => {
            if (data && data.rates) {
              const usd = (1 / data.rates.USD).toFixed(2);
              const eur = (1 / data.rates.EUR).toFixed(2);
              const cny = (1 / data.rates.CNY).toFixed(2);

              currencyDiv.innerHTML = `
                USD: ${usd} ‚ÇΩ<br/>
                EUR: ${eur} ‚ÇΩ<br/>
                CNY: ${cny} ‚ÇΩ
              `;
            } else {
              currencyDiv.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç.";
            }
          })
          .catch(() => {
            currencyDiv.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç.";
          });
      }
      loadCurrency();

      // --- –ó–∞–º–µ—Ç–∫–∏ ---
      let notes = JSON.parse(localStorage.getItem("notes")) || [];
      const notesList = document.getElementById("notesList");
      const notesModal = document.getElementById("notesModal");
      const modalContent = document.getElementById("modalContent");
      const noteTextInput = document.getElementById("noteText");
      const notePrioritySelect = document.getElementById("notePriority");
      const openNotesBtn = document.getElementById("openNotesBtn");
      const addNoteBtn = document.getElementById("addNoteBtn");
      const closeNotesBtn = document.getElementById("closeNotesBtn");

      function saveNotes() {
        localStorage.setItem("notes", JSON.stringify(notes));
      }

      function translatePriority(p) {
        const map = {
          low: "–ù–∏–∑–∫–∏–π",
          medium: "–°—Ä–µ–¥–Ω–∏–π",
          high: "–í—ã—Å–æ–∫–∏–π",
        };
        return map[p] || p;
      }

      function renderNotes() {
        if (notes.length === 0) {
          notesList.innerHTML = "<i>–ó–∞–º–µ—Ç–æ–∫ –Ω–µ—Ç</i>";
          return;
        }
        notesList.innerHTML = notes
          .map(
            (n, i) => `
          <div class="note-item">
            <input type="checkbox" id="note_${i}" ${n.done ? "checked" : ""} onchange="toggleNote(${i})" />
            <label for="note_${i}" class="${n.done ? "completed" : ""}">${n.text}</label>
            <em style="margin-left: 8px;">[${translatePriority(n.priority)}]</em>
          </div>`
          )
          .join("");
      }

      window.toggleNote = function (index) {
        notes[index].done = !notes[index].done;
        saveNotes();
        renderNotes();
      };

      function addNote() {
        const text = noteTextInput.value.trim();
        const priority = notePrioritySelect.value;
        if (!text) return alert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏");
        notes.push({ text, priority, done: false });
        saveNotes();
        renderNotes();
        noteTextInput.value = "";
        notePrioritySelect.value = "low";
        notesModal.classList.remove("show");
      }

      openNotesBtn.addEventListener("click", () => {
        notesModal.classList.add("show");
        noteTextInput.focus();
      });
      closeNotesBtn.addEventListener("click", () => {
        notesModal.classList.remove("show");
      });
      notesModal.addEventListener("click", (e) => {
        if (e.target === notesModal) notesModal.classList.remove("show");
      });
      addNoteBtn.addEventListener("click", addNote);

      renderNotes();
    })();
  </script>
</body>
</html>
